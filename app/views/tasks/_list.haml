#task_list

  - completed, open  = list.partition {|task| task.completed? }
  - late, upcoming = open.partition {|task| task.late? }
  - tasks = [[:late, late], [:upcoming, upcoming], [:completed, completed]]
  - tasks.each do |type, tasks|

    - unless tasks.empty?
      %div{:class => "task_list #{type}"}
        %div{:class => "task_list_header header_#{type}"}= type.to_s.capitalize

        - tasks.reverse.each do |task|
          %div{:class => "task_list_item #{type}", :id => "task_item_#{task.id}"}

            %div{:class => "list_item_date #{type}"}
              = task.end_date.to_s(:long)
              - if task.open?
                - if task.days_remaining > 1
                  == (#{task.days_remaining} days away)
                - else
                  == (#{task.days_remaining.abs} days ago)
            \-
            .task_users
              - if task.users.empty?
                %span{:style => 'color:red;'}Not assigned
              - else
                = task.users.map{ |user| link_to user.name, user }.join(', ')

            .task_name
              - form_for task do |f|
                = f.check_box :completed
                = link_to task.name, project_task_path(task.project, task), :style => 'color: #000;'
                %span{:style => "font-size: .6em; color:red;"}= '(Urgent)' if task.urgent?
              = observe_form "edit_task_#{task.id}", :frequency => 0.25, :url => {:controller => 'tasks', :action => 'update', :id => task}, :update => "task_list", :complete => update_page {|p| p[:"task_item_#{task.id}"].visual_effect :highlight }

      %br
