%table{:cellspacing => 0, :style => 'width:100%;'}
  - projects.each do |project|
    %tr
      %td.project_row{:style => 'width: 2%;'}
        %div{:style => "height: 20px; width: 20px; background-color: ##{project.colour}"}

      %td.project_row{:style => project.style + 'width: 25%;'}
        = link_to project.full_name, project

      %td.project_row{:style => 'width: 73%;'}
        %script{:type=>"text/javascript"}== $(function() {$("#progressbar#{project.id}").progressbar({value: #{project.percentage_complete}});});

        .progressbar{:id=>"progressbar#{project.id}", :style => 'positions:relative;'}
          %div{:style => 'position: absolute; padding-left: 10px;padding-top: 5px;'}
            = project.tasks.completed.count
            \/
            = project.tasks.count

          %div{:style => 'position: absolute; padding-left: 120px;padding-top: 5px;'}
            %b
              = project.percentage_complete
              \%

          %div{:style => 'position: absolute; padding-left: 200px;padding-top: 5px;'}
            = project.end_date
            == (#{project.days_remaining})

          %div{:style => 'position: absolute; padding-left: 330px;padding-top: 5px;'}
            = link_to 'new event', new_project_event_path(project)
            |
            = link_to 'new task', new_project_task_path(project)
            - unless project.tasks.open.empty?
              |
              = link_to_function "show tasks", :href => nil, :id => "show_project#{project.id}_link" do |page|
                - page[:"project#{project.id}"].visual_effect :blind_down, :duration => 0.5
                - page[:"show_project#{project.id}_link"].hide
                - page[:"hide_project#{project.id}_link"].show

              = link_to_function "hide tasks", :href => nil, :id => "hide_project#{project.id}_link", :style => "display:none;" do |page|
                - page[:"project#{project.id}"].visual_effect :blind_up, :duration => 0.5
                - page[:"hide_project#{project.id}_link"].hide
                - page[:"show_project#{project.id}_link"].show

            |
            - if project.closed?
              = link_to 'reopen', reopen_project_path(project)
            - else
              = link_to 'close', close_project_path(project)

        %div{:id => "project#{project.id}", :style => 'display:none;'}
          - unless project.tasks.open.empty?
            %p= render :partial => 'tasks/list', :locals => {:tasks => project.tasks.open }
