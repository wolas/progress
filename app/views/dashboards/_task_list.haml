#task_list
  - completed, open = tasks.partition {|task| task.completed? }
  - late, upcoming = open.partition {|task| task.late? }
  - list = [[:late, late], [:upcoming, upcoming]]

  - list.each do |type, tasks|

    - unless tasks.empty?
      %div{:class => "task_list #{type}"}
        %div{:class => "task_list_header header_#{type}"}= type.to_s.capitalize

        - tasks.reverse.each do |task|
          %div{:class => "task_list_item #{type}", :id => "task_item_#{task.id}"}

            %div{:class => "list_item_date #{type}"}
              = task.end_date.to_s(:long)
              - if task.days_remaining > 1
                == (#{task.days_remaining} days away)
              - if task.open? and task.days_remaining < 1
                == (#{task.days_remaining.abs} days ago)
            \-
            .task_users= collection_widget_for task.users, :object => task, :hide => true

            .task_name
              - form_for task do |f|
                = f.check_box :completed
                %span{:style => 'color: #000;font-weight: normal;'}
                  - project = task.project
                  ==(#{link_to project.name, project}#{" for #{project.client.name}" if project.client})
                = link_to task.name, project_task_path(task.project, task), :style => 'color: #000;'

              = observe_form "edit_task_#{task.id}", :frequency => 0.25, :url => {:controller => 'dashboards', :action => 'update_task', :id => task}, :update => "task_list", :loading => update_page {|p| p[:"task_item_#{task.id}"].visual_effect :highlight }

      %br
